## ãƒ­ãƒ¼ã‚°ãƒ©ã‚¤ã‚¯ã‚²ãƒ¼ãƒ ã‚’ä½œã£ã¦ã¿ã‚‹ãã®5 ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ã®ã‚µã‚¤ã‚º

### éŽåŽ»è¨˜äº‹ä¸€è¦§

* [ãã®1 ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢](https://qiita.com/pizyumi/items/3526fddd4f18a462e1ae)
* [ãã®2 ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ãƒ»ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ç”Ÿæˆã¨æç”»](https://qiita.com/pizyumi/items/2562a159f497a608615b)
* [ãã®3 ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ç§»å‹•]()
* [ãã®4 ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ã®ãƒ©ãƒ³ãƒ€ãƒ ç”Ÿæˆ]()

ç¾åœ¨ã®ã‚³ãƒ¼ãƒ‰ã«ã¤ã„ã¦ã¯å‰å›žã®è¨˜äº‹ã®æœ€å¾Œã®é …ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ã®ã‚µã‚¤ã‚º

ä»Šã¾ã§ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ã®ãƒ•ãƒ­ã‚¢ã®ã‚µã‚¤ã‚ºã¯25ãƒžã‚¹x25ãƒžã‚¹ã§å›ºå®šã§ã—ãŸã€‚

ä»Šå›žã¯ã‚ˆã‚Šåºƒã„ã‚µã‚¤ã‚ºã®ãƒ•ãƒ­ã‚¢ã‚’ç”Ÿæˆã—ãŸã‚Šã€æç”»ã—ãŸã‚Šã§ãã‚‹ã‚ˆã†ã«ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚

ã‚²ãƒ¼ãƒ ç”»é¢ã®ã‚µã‚¤ã‚ºã¯å¤‰æ›´ã—ã¾ã›ã‚“ã®ã§ã€ã‚ˆã‚Šåºƒã„ã‚µã‚¤ã‚ºã®ãƒ•ãƒ­ã‚¢ã‚’ç”Ÿæˆã™ã‚‹ã¨å¿…ç„¶çš„ã«ãƒ•ãƒ­ã‚¢ã®ä¸€éƒ¨ã—ã‹è¡¨ç¤ºã§ããªã„ã¨ã„ã†ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

ãã®ãŸã‚ã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ä½ç½®ã«å¿œã˜ã¦ãƒ•ãƒ­ã‚¢ã®ã©ã®éƒ¨åˆ†ã‚’æç”»ã™ã‚‹ã‹ã‚’æ±ºã‚ãªã‘ã‚Œã°ãªã‚‰ãªããªã‚Šã¾ã™ã€‚

---

ã¾ãšãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ç”Ÿæˆå‡¦ç†ã‚’å¤‰æ›´ã—ã¾ã—ã‚‡ã†ã€‚

`create_field`é–¢æ•°ã‚’ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ã€‚

`nx`å¤‰æ•°ã¨`ny`å¤‰æ•°ãŒãƒ•ãƒ­ã‚¢ã®å¤§ãã•ã‚’è¡¨ã—ã¾ã™ã€‚0éšŽã¯25ãƒžã‚¹x25ãƒžã‚¹ã®ã¾ã¾ã¨ã™ã‚‹ã“ã¨ã«ã—ã¾ã™ãŒã€1éšŽä»¥é™ã¯50ãƒžã‚¹x50ãƒžã‚¹ã«å¤‰æ›´ã—ã¦ã¿ã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚

ãã†ã™ã‚‹ã¨ã€ãƒ–ãƒ­ãƒƒã‚¯ã®ç”Ÿæˆå‡¦ç†ã¯`nx`å¤‰æ•°ã¨`ny`å¤‰æ•°ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«ã—ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚ã¾ãŸã€ä»–ã®å¹¾ã¤ã‹ã®éƒ¨åˆ†ã§ã‚‚`nx`å¤‰æ•°ã¨`ny`å¤‰æ•°ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«ã—ãªã‘ã‚Œã°ãªã‚‰ãªããªã‚Šã¾ã™ã€‚

ã¾ãŸã€`create_field`é–¢æ•°ã®è¿”ã‚Šå€¤ã¨ãªã‚‹ãƒ•ãƒ­ã‚¢ã‚’è¡¨ã™ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã¯`nx`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨`ny`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨ã—ã¦ãƒ•ãƒ­ã‚¢ã®ã‚µã‚¤ã‚ºã‚’å«ã‚ã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚

```js
function create_field (depth, upstairs, base_seed) {
	var random = new Random(base_seed + ',' + depth.toString(10));

	var nx = 25;
	var ny = 25;
	if (depth > 0) {
		nx = 50;
		ny = 50;
	}

	var blocks = [];
	for (var i = 0; i < nx; i++) {
		blocks[i] = [];
		for (var j = 0; j < ny; j++) {
			if ((i === 0 || j === 0) || (i === nx - 1 || j === ny - 1)) {
				blocks[i][j] = {
					base: B_WALL
				};
			}
			else {
				blocks[i][j] = {
					base: B_FLOOR
				};
			}
		}
	}

	if (depth === 0) {
		blocks[12][5] = {
			base: B_DOWNSTAIR
		};

		return {
			nx: nx,
			ny: ny,
			blocks: blocks
		};
	}

	var rs = [{
		x1: 1,
		x2: nx - 2,
		y1: 1,
		y2: ny - 2
	}];
	var ers = [];
	var dps = [1, 1, 1, 1, 1, 1, 0.5, 0.5, 0.5, 0.5];
	while (rs.length > 0 && dps.length > 0) {
		var r = rs.shift();
		var nrs = split_room(blocks, r.x1, r.x2, r.y1, r.y2, dps.shift(), random);
		for (var i = 0; i < nrs.length; i++) {
			rs.push(nrs[i]);
		}
		if (nrs.length === 0) {
			ers.push(r);
		}
	}
	while (rs.length > 0) {
		ers.push(rs.shift());
	}

	var nds = 1;
	while (nds > 0) {
		var x = random.num(nx - 2) + 1;
		var y = random.num(ny - 2) + 1;
		var f = true;
		for (var i = 0; i < upstairs.length; i++) {
			if (x === upstairs[i].x && y === upstairs[i].y) {
				f = false;
				break;
			}
		}
		if (f) {
			blocks[x][y].base = B_DOWNSTAIR;
			nds--;
		}
	}

	for (var i = 0; i < upstairs.length; i++) {
		if (blocks[upstairs[i].x][upstairs[i].y].base = B_WALL) {
			blocks[upstairs[i].x][upstairs[i].y].base = B_FLOOR;
		}
	}

	return {
		nx: nx,
		ny: ny,
		blocks: blocks
	};
}
```

æ¬¡ã«ã‚­ãƒ¼å…¥åŠ›ã®å‡¦ç†ã‚’å¤‰æ›´ã—ã¾ã™ã€‚

2ã¤ç›®ã®`keydown`ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã‚’ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ã€‚

çŸ¢å°ã‚­ãƒ¼ãŒæŠ¼ã•ã‚ŒãŸå ´åˆã«ã¯ã¾ãšãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒç¾åœ¨ã„ã‚‹ãƒ•ãƒ­ã‚¢ã®ã‚µã‚¤ã‚ºã‚’å–å¾—ã—ã€`nx`å¤‰æ•°ã¨`ny`å¤‰æ•°ã«æ ¼ç´ã—ã¾ã™ã€‚

ãã—ã¦ã€ã“ã‚Œã‚‰ã®å¤‰æ•°ã®å€¤ã‚’ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒãƒ•ãƒ­ã‚¢ã®ç«¯ã«ã„ã‚‹ã‹ã‚’åˆ¤å®šã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

```js
	c.on('keydown', function (e) {
ï¼ˆçœç•¥ï¼‰
		if (e.keyCode >= 37 && e.keyCode <= 40) {
			var nx = fields[player.depth].nx;
			var ny = fields[player.depth].ny;
			var x = player.x;
			var y = player.y;
			if (e.shiftKey) {
				if (keyl && keyu) {
					if (x === 0 || y === 0) {
						return;
					}
					x--;
					y--;
				}
				else if (keyr && keyu) {
					if (x === nx - 1 || y === 0) {
						return;
					}
					x++;
					y--;
				}
				else if (keyl && keyd) {
					if (x === 0 || y === ny - 1) {
						return;
					}
					x--;
					y++;
				}
				else if (keyr && keyd) {
					if (x === nx - 1 || y === ny - 1) {
						return;
					}
					x++;
					y++;
				}
				else {
					return;
				}
			}
			else {
				if (e.keyCode === 37) {
					if (x === 0) {
						return;
					}
					x--;
				}
				else if (e.keyCode === 38) {
					if (y === 0) {
						return;
					}
					y--;
				}
				else if (e.keyCode === 39) {
					if (x === nx - 1) {
						return;
					}
					x++;
				}
				else if (e.keyCode === 40) {
					if (y === ny - 1) {
						return;
					}
					y++;
				}
			}
ï¼ˆçœç•¥ï¼‰
		}
		else if (e.keyCode === 32) {
ï¼ˆçœç•¥ï¼‰
		}
	});
```

æ¬¡ã«æç”»å‡¦ç†ã‚’å¤‰æ›´ã—ã¾ã™ã€‚

æç”»å‡¦ç†ã«ãŠã„ã¦ã¯ã‚²ãƒ¼ãƒ ç”»é¢ã§ãƒ•ãƒ­ã‚¢ã®ãƒžã‚¹ã‚’ä½•ãƒžã‚¹xä½•ãƒžã‚¹æç”»ã™ã‚‹ã‹ã¨ã„ã†æƒ…å ±ãŒå¿…è¦ã¨ãªã‚Šã¾ã™ã®ã§ã€ä¸‹ã®ã‚ˆã†ãª`SX`å¤‰æ•°ã¨`SY`å¤‰æ•°ã‚’å®šç¾©ã—ã¾ã™ã€‚

ã“ã‚Œã‚‰ã®å€¤ã¯`25`ã¨ã—ã¾ã™ã€‚ã¤ã¾ã‚Šã€ã‚²ãƒ¼ãƒ ç”»é¢ã§ã¯25ãƒžã‚¹x25ãƒžã‚¹ã‚’ä¸€åº¦ã«æç”»ã™ã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚ã“ã‚Œã¯å‰å›žã¾ã§ã¨åŒã˜ã‚µã‚¤ã‚ºã§ã™ã€‚

ãŸã ã€ä»Šå¾Œã¯25ãƒžã‚¹x25ãƒžã‚¹ã‚ˆã‚Šåºƒã„ãƒ•ãƒ­ã‚¢ã‚’æç”»ã™ã‚‹å ´åˆã«ã¯ä¸€åº¦ã«ãƒ•ãƒ­ã‚¢ã®ä¸€éƒ¨ã—ã‹æç”»ã§ããªã„ã¨ã„ã†ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

ãƒ•ãƒ­ã‚¢ã¯åŸºæœ¬çš„ã«ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ä¸­å¿ƒã¨ã—ã¦ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å‘¨ã‚Šã®25ãƒžã‚¹x25ãƒžã‚¹ã‚’æç”»ã™ã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚

ãŸã ã—ã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒãƒ•ãƒ­ã‚¢ã®ç«¯ã®æ–¹ã«ã„ã‚‹å ´åˆã«ã¯ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ä¸­å¿ƒã¨ã—ãŸæç”»ã‚’è¡Œã†ã¨ã‚²ãƒ¼ãƒ ç”»é¢ã«ä½™ç™½ãŒç¾ã‚Œã¦ã—ã¾ã„ã¾ã™ã®ã§ã€ä½™ç™½ãŒç¾ã‚Œãªã„ã‚ˆã†ã«æç”»ã—ã¾ã™ã€‚

ã¤ã¾ã‚Šã€ã‚²ãƒ¼ãƒ ç”»é¢ã«ã¯ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒ•ãƒ­ã‚¢å†…ã§ã®ä½ç½®ã«æ‹˜ã‚ã‚‰ãšå¸¸ã«25ãƒžã‚¹x25ãƒžã‚¹ãŒæç”»ã•ã‚Œã¾ã™ã€‚

ã“ã®ã‚ˆã†ãªæç”»ã‚’å®Ÿç¾ã™ã‚‹ã«ã¯`draw`é–¢æ•°ã‚’ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ã€‚

ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒç¾åœ¨ã„ã‚‹ãƒ•ãƒ­ã‚¢ã®ã‚µã‚¤ã‚ºã‚’å–å¾—ã—ã€`nx`å¤‰æ•°ã¨`ny`å¤‰æ•°ã«æ ¼ç´ã—ã¾ã™ã€‚

ãã—ã¦ã€`ox`å¤‰æ•°ã¨`oy`å¤‰æ•°ã«ã‚²ãƒ¼ãƒ ç”»é¢ã«ãŠã„ã¦æç”»ã‚’è¡Œã†ãƒ•ãƒ­ã‚¢ã®ãƒžã‚¹ã®å·¦ä¸Šç«¯ã®ä½ç½®ã‚’æ ¼ç´ã—ã¾ã™ã€‚

æç”»ã‚’è¡Œã†ãƒ•ãƒ­ã‚¢ã®ãƒžã‚¹ã®å·¦ä¸Šç«¯ã®ä½ç½®ãŒåˆ†ã‹ã‚Œã°ã€ãƒžã‚¹ã®æç”»ã¯äºŒé‡`for`æ–‡ã§ç°¡å˜ã«è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚

ãã—ã¦ã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚²ãƒ¼ãƒ ç”»é¢ã«ãŠã‘ã‚‹æç”»ä½ç½®ã¯ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒ•ãƒ­ã‚¢ã«ãŠã‘ã‚‹ä½ç½®ã‹ã‚‰ã‚²ãƒ¼ãƒ ç”»é¢ã«ãŠã„ã¦æç”»ã‚’è¡Œã†ãƒ•ãƒ­ã‚¢ã®ãƒžã‚¹ã®å·¦ä¸Šç«¯ã®ä½ç½®ã‚’å·®ã—å¼•ãã“ã¨ã«ã‚ˆã£ã¦æ±‚ã‚ã‚‰ã‚Œã¾ã™ã€‚

```js
function draw (con, env) {
ï¼ˆçœç•¥ï¼‰
	var nx = fields[player.depth].nx;
	var ny = fields[player.depth].ny;

	var ox = 0;
	if (player.x <= Math.floor(SX / 2)) {
		ox = 0;
	}
	else if (player.x >= nx - Math.floor(SX / 2)) {
		ox = nx - SX;
	}
	else {
		ox = player.x - Math.floor(SX / 2);
	}

	var oy = 0;
	if (player.y <= Math.floor(SY / 2)) {
		oy = 0;
	}
	else if (player.y >= ny - Math.floor(SY / 2)) {
		oy = ny - SY;
	}
	else {
		oy = player.y - Math.floor(SY / 2);
	}

	for (var i = 0; i < SX; i++) {
		for (var j = 0; j < SY; j++) {
			var block = fields[player.depth].blocks[ox + i][oy + j];
ï¼ˆçœç•¥ï¼‰
		}
	}

	var px = player.x - ox;
	var py = player.y - oy;

	con.textBaseline = 'middle';
	con.textAlign = 'center';
	con.fillStyle = 'red';
	con.fillText('ðŸš¶\uFE0E', px * PX + (PX / 2), py * PY + (PY / 2));

	if (env.diagonal) {
		con.save();

		con.strokeStyle = 'white';
		con.translate(px * PX + (PX / 2), py * PY + (PY / 2));
		con.rotate(Math.PI / 4);
ï¼ˆçœç•¥ï¼‰
	}
}
```




### ä»Šå›žã¯ã“ã“ã¾ã§

ä»Šå›žã¯ã“ã“ã¾ã§ã§ã™ã€‚

`game.js`ã¯ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

```js
ï»¿```

æ¬¡å›žã¯ã‚²ãƒ¼ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã«ã¤ã„ã¦è€ƒãˆãŸã„ã¨æ€ã„ã¾ã™ã€‚
