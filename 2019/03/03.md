### éŽåŽ»è¨˜äº‹ä¸€è¦§

* [ãã®1 ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢](https://qiita.com/pizyumi/items/3526fddd4f18a462e1ae)
* [ãã®2 ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ãƒ»ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ç”Ÿæˆã¨æç”»](https://qiita.com/pizyumi/items/2562a159f497a608615b)

ç¾åœ¨ã®ã‚³ãƒ¼ãƒ‰ã«ã¤ã„ã¦ã¯å‰å›žã®è¨˜äº‹ã®æœ€å¾Œã®é …ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ç§»å‹•

ã“ã®ã‚²ãƒ¼ãƒ ã¯åŸºæœ¬çš„ã«ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚’ä½¿ã£ã¦æ“ä½œã™ã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚

ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ç§»å‹•ã¯çŸ¢å°ã‚­ãƒ¼ã‚’ä½¿ã£ã¦è¡Œã†ã“ã¨ã«ã—ã¾ã™ã€‚

ã¾ãšã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯å…¨ã¦ã®ãƒžã‚¹ã«ç§»å‹•ã§ãã‚‹è¨³ã§ã¯ãªã„ã®ã§ã—ãŸã€‚

åºŠã®ãƒžã‚¹ã«ã¯ç§»å‹•ã§ãã¾ã™ãŒã€å£ã®ãƒžã‚¹ã«ã¯ç§»å‹•ã§ãã¾ã›ã‚“ã€‚

ã¤ã¾ã‚Šã€ãƒžã‚¹ã®ç¨®é¡žã«ã‚ˆã£ã¦ç§»å‹•ã§ãã‚‹ã‹ã©ã†ã‹ãŒæ±ºã¾ã‚Šã¾ã™ã€‚

ã“ã‚Œã‚’`B_CAN_STAND`ã¨ã„ã†é…åˆ—ã§ä¸‹ã®ã‚ˆã†ã«å®šç¾©ã™ã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚`true`ã¯ç§»å‹•ã§ãã‚‹ãƒžã‚¹ã§ã‚ã‚‹ã“ã¨ã‚’è¡¨ã—ã€`false`ã¯ç§»å‹•ã§ããªã„ãƒžã‚¹ã§ã‚ã‚‹ã“ã¨ã‚’è¡¨ã—ã¾ã™ã€‚

```js
var B_CAN_STAND = [];
B_CAN_STAND[B_FLOOR] = true;
B_CAN_STAND[B_WALL] = false;
```

ãã—ã¦ã€ã‚­ãƒ¼å…¥åŠ›ã®å‡¦ç†ã‚’ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ã€‚

ãªãŠã€çŸ¢å°ã‚­ãƒ¼ã®`keyCode`ã®å€¤ã¯ãã‚Œãžã‚Œä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

* `â†`ãƒ»ãƒ»ãƒ»`37`
* `â†‘`ãƒ»ãƒ»ãƒ»`38`
* `â†’`ãƒ»ãƒ»ãƒ»`39`
* `â†“`ãƒ»ãƒ»ãƒ»`40`

```js
	c.on('keydown', function (e) {
ï¼ˆçœç•¥ï¼‰
		if (e.keyCode >= 37 && e.keyCode <= 40) {
			var x = player.x;
			var y = player.y;
			if (e.keyCode === 37) {
				if (x === 0) {
					return;
				}
				x--;
			}
			else if (e.keyCode === 38) {
				if (y === 0) {
					return;
				}
				y--;
			}
			else if (e.keyCode === 39) {
				if (x === LX - 1) {
					return;
				}
				x++;
			}
			else if (e.keyCode === 40) {
				if (y === LY - 1) {
					return;
				}
				y++;
			}

			if (x !== player.x || y !== player.y) {
				var block = field.blocks[x][y];
				if (B_CAN_STAND[block.base]) {
					player.x = x;
					player.y = y;
				}
				else {
					return;
				}
			}
			else {
				return;
			}
		}
		else {
			return;
		}

		draw(con);
	});
```

çŸ¢å°ã‚­ãƒ¼ãŒæŠ¼ã•ã‚ŒãŸæ™‚ã®å‡¦ç†ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚

çŸ¢å°ã‚­ãƒ¼ã®ç¨®é¡žã«ã‚ˆã£ã¦ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ–°ã—ã„ä½ç½®ãŒæ±ºã¾ã‚Šã€ãã®ä½ç½®ã®ãƒžã‚¹ã®ç¨®é¡žãŒç§»å‹•ã§ãã‚‹ã‚‚ã®ã§ã‚ã‚‹å ´åˆã«ã¯ç§»å‹•ã—ï¼ˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ä½ç½®ã‚’æ›´æ–°ã—ï¼‰ã€å†æç”»ã‚’è¡Œã„ã¾ã™ã€‚

[](https://codepen.io/pizyumi/pen/ExYOVwj)

<p class="codepen" data-height="600" data-theme-id="0" data-default-tab="result" data-user="pizyumi" data-slug-hash="ExYOVwj" style="height: 600px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;" data-pen-title="roguelike-3-1">
  <span>See the Pen <a href="https://codepen.io/pizyumi/pen/ExYOVwj/">
  roguelike-3-1</a> by pizyumi (<a href="https://codepen.io/pizyumi">@pizyumi</a>)
  on <a href="https://codepen.io">CodePen</a>.</span>
</p>
<script async src="https://static.codepen.io/assets/embed/ei.js"></script>

### æ–œã‚ç§»å‹•

ãƒ­ãƒ¼ã‚°ãƒ©ã‚¤ã‚¯ã‚²ãƒ¼ãƒ ã¯ã‚„ã£ã±ã‚Šæ–œã‚ç§»å‹•ã‚‚ã§ããªã„ã¨ã§ã™ã‚ˆã­ã€‚

æ–œã‚ç§»å‹•ã‚’å®Ÿè£…ã—ã¾ã—ã‚‡ã†ã€‚

æ–œã‚ç§»å‹•ã¯`Shift`ã‚­ãƒ¼ã‚’æŠ¼ã—ãªãŒã‚‰çŸ¢å°ã‚­ãƒ¼ã‚’æŠ¼ã™ã“ã¨ã§è¡Œã†ã“ã¨ã«ã—ã¾ã™ã€‚

å®Ÿè£…ã«ãŠã„ã¦ã¯å°‘ãªãã¨ã‚‚ä»¥ä¸‹ã®2ç‚¹ã‚’æº€ãŸã™å¿…è¦ãŒã‚ã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚

* `Shift`ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ã„ã‚‹æ™‚ã®ã¿ã—ã‹æ–œã‚ç§»å‹•ã§ããªã„ï¼ˆ`Shift`ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ã„ãªã„ã®ã«æ–œã‚ç§»å‹•ã§ãã¦ã¯ãªã‚‰ãªã„ï¼‰ã€‚
* `Shift`ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ã„ã‚‹æ™‚ã«ã¯æ–œã‚ç§»å‹•ã—ã‹å‡ºæ¥ãªã„ï¼ˆ`Shift`ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ã„ã‚‹æ™‚ã«ã¯ä¸Šä¸‹å·¦å³ã®ç§»å‹•ã¯ã§ãã¦ã¯ãªã‚‰ãªã„ï¼‰ã€‚

ã“ã®ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šã€èª¤æ“ä½œãŒèµ·ãã«ãããªã‚Šã¾ã™ã€‚

ã“ã®ã‚ˆã†ãªæ–œã‚ç§»å‹•ã®å®Ÿè£…æ–¹æ³•ã¯å¹¾ã¤ã‹ã‚ã‚‹ã¨æ€ã„ã¾ã™ãŒã€ç§ã¯ä¸‹ã®ã‚ˆã†ãªå®Ÿè£…æ–¹æ³•ãŒå¥½ãã§ã™ã€‚

`keyl`ã€`keyu`ã€`keyr`ã€`keyd`ã¨ã„ã†å¤‰æ•°ã‚’ç”¨æ„ã—ã€çŸ¢å°ã‚­ãƒ¼ãŒæŠ¼ã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’å¸¸ã«ç›£è¦–ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

ãã—ã¦ã€`Shift`ã‚­ãƒ¼ãŒæŠ¼ã•ã‚Œã¦ã„ã‚‹å ´åˆã«ã¯ã“ã‚Œã‚‰ã®å¤‰æ•°ã®å€¤ã‚’åŸºã«ç§»å‹•ã‚’è¡Œã†ã¹ãã‹ã‚’åˆ¤æ–­ã—ã¾ã™ã€‚

```js
	var keyl = false;
	var keyu = false;
	var keyr = false;
	var keyd = false;

	var c = $('body');
	c.on('keydown', function (e) {
		if (e.keyCode === 37) {
			keyl = true;
		}
		else if (e.keyCode === 38) {
			keyu = true;
		}
		else if (e.keyCode === 39) {
			keyr = true;
		}
		else if (e.keyCode === 40) {
			keyd = true;
		}
		else {
			keyl = false;
			keyu = false;
			keyr = false;
			keyd = false;
		}
	});
	c.on('keyup', function (e) {
		if (e.keyCode === 37) {
			keyl = false;
		}
		else if (e.keyCode === 38) {
			keyu = false;
		}
		else if (e.keyCode === 39) {
			keyr = false;
		}
		else if (e.keyCode === 40) {
			keyd = false;
		}
	});
	c.on('keydown', function (e) {
ï¼ˆçœç•¥ï¼‰
		if (e.keyCode >= 37 && e.keyCode <= 40) {
			var x = player.x;
			var y = player.y;
			if (e.shiftKey) {
				if (keyl && keyu) {
					if (x === 0 || y === 0) {
						return;
					}
					x--;
					y--;
				}
				else if (keyr && keyu) {
					if (x === LX - 1 || y === 0) {
						return;
					}
					x++;
					y--;
				}
				else if (keyl && keyd) {
					if (x === 0 || y === LY - 1) {
						return;
					}
					x--;
					y++;
				}
				else if (keyr && keyd) {
					if (x === LX - 1 || y === LY - 1) {
						return;
					}
					x++;
					y++;
				}
				else {
					return;
				}
			}
			else {
				if (e.keyCode === 37) {
					if (x === 0) {
						return;
					}
					x--;
				}
				else if (e.keyCode === 38) {
					if (y === 0) {
						return;
					}
					y--;
				}
				else if (e.keyCode === 39) {
					if (x === LX - 1) {
						return;
					}
					x++;
				}
				else if (e.keyCode === 40) {
					if (y === LY - 1) {
						return;
					}
					y++;
				}
			}

			if (x !== player.x || y !== player.y) {
ï¼ˆçœç•¥ï¼‰
			}
			else {
				return;
			}
		}
		else {
			return;
		}

		draw(con);
	});
```

### æ–œã‚çŸ¢å°ã®è¡¨ç¤º

`Shift`ã‚­ãƒ¼ã‚’æŠ¼ã—ãŸæ™‚ã«æ–œã‚ç§»å‹•ãŒå¯èƒ½ãªã“ã¨ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«åˆ†ã‹ã‚Šã‚„ã™ãè¦‹ã›ã‚‹ãŸã‚ã«ã€`Shift`ã‚­ãƒ¼ã‚’æŠ¼ã—ãŸæ™‚ã«ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å‘¨ã‚Šã«æ–œã‚çŸ¢å°ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚

ã“ã®æ–œã‚çŸ¢å°ã¯ã€ãŸã¨ãˆã°ã€ãµã—å¹»ï¼ˆä¸æ€è­°ã®å¹»æƒ³éƒ·ï¼‰ã§ã‚‚æŽ¡ç”¨ã•ã‚Œã¦ã„ã¾ã™ã­ã€‚

![01.jpg](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/10969/8014acad-2342-860d-a6ca-49e852c56845.jpeg)

ã“ã‚Œã‚’è¡Œã†ã«ã¯ã€`Shift`ã‚­ãƒ¼ãŒæŠ¼ã•ã‚Œã¦ã„ã‚‹ã‹ï¼ˆã¨ã„ã†ã‹æ–œã‚ç§»å‹•å¯èƒ½ãªçŠ¶æ…‹ã‹ï¼‰ã‚’ä¿æŒã—ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ã“ã®çŠ¶æ…‹ã¯`env.diagonal`ã§ä¿æŒã™ã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚`env.diagonal`ã®å€¤ãŒ`true`ã§ã‚ã‚‹å ´åˆã«ã¯æ–œã‚ç§»å‹•å¯èƒ½ã§ã€`false`ã§ã‚ã‚‹å ´åˆã«ã¯æ–œã‚ç§»å‹•ä¸å¯èƒ½ã§ã™ã€‚

```js
	var env = {
		diagonal: false
	};
```

ãã—ã¦ã€ã“ã®çŠ¶æ…‹ï¼ˆ`env.diagonal`ã®å€¤ï¼‰ã«ã‚ˆã£ã¦ã‚²ãƒ¼ãƒ ã®æç”»å†…å®¹ï¼ˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å‘¨ã‚Šã«æ–œã‚çŸ¢å°ã‚’è¡¨ç¤ºã™ã‚‹ã‹ã©ã†ã‹ï¼‰ãŒå¤‰ã‚ã‚Šã¾ã™ã®ã§ã€ã“ã®çŠ¶æ…‹ã¯`draw`é–¢æ•°ã«æ¸¡ã•ãªã‘ã‚Œã°ãªã‚‰ãªã„ã¨ã„ã†ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

ãã“ã§ã€å…¨ã¦ã®`draw`é–¢æ•°ã®å‘¼ã³å‡ºã—ã«ãŠã„ã¦ã¯`env`ã‚’ç¬¬2å¼•æ•°ã¨ã—ã¦æŒ‡å®šã™ã‚‹ã“ã¨ã«ã—ã¾ã™ï¼ˆå¤‰æ›´ã—ãŸã‚³ãƒ¼ãƒ‰ã¯ç¤ºã—ã¾ã›ã‚“ãŒã€å…¨ã¦ã®`draw`é–¢æ•°ã®å‘¼ã³å‡ºã—ã§ç¬¬2å¼•æ•°ã¨ã—ã¦`env`ã‚’æ¸¡ã™ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ï¼‰ã€‚

ãã†ã—ãŸã‚‰ã€2ã¤ç›®ã®`keydown`ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã‚’ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ã€‚

ã¤ã¾ã‚Šã€`Shift`ã‚­ãƒ¼ãŒæŠ¼ã•ã‚ŒãŸå ´åˆã®å‡¦ç†ã‚’è¿½åŠ ã—ã¾ã™ã€‚

`Shift`ã‚­ãƒ¼ãŒæŠ¼ã•ã‚ŒãŸå ´åˆã«ã¯`env.diagonal`ã®å€¤ã‚’`true`ã«ã—ã€å†æç”»ã‚’è¡Œã„ã¾ã™ã€‚

```js
	c.on('keydown', function (e) {
		if (!startf) {
ï¼ˆçœç•¥ï¼‰
		}

		if (e.keyCode === 16) {
			if (!env.diagonal) {
				env.diagonal = true;

				draw(con, env);
			}

			return;
		}

		if (e.keyCode >= 37 && e.keyCode <= 40) {
ï¼ˆçœç•¥ï¼‰
		}
		else {
			return;
		}

		draw(con, env);
	});
```

æ›´ã«ã€æ–°ãŸã«`keyup`ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã¨`window`ã®`blur`ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã‚’è¿½åŠ ã—ã¾ã™ã€‚

`keyup`ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã«ã¯`Shift`ã‚­ãƒ¼ãŒé›¢ã•ã‚ŒãŸå ´åˆã®å‡¦ç†ã‚’è¨˜è¿°ã—ã¾ã™ã€‚

`Shift`ã‚­ãƒ¼ãŒé›¢ã•ã‚ŒãŸå ´åˆã«ã¯`env.diagonal`ã®å€¤ã‚’`false`ã«ã—ã€å†æç”»ã‚’è¡Œã„ã¾ã™ã€‚

`blur`ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã«ã¯ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‹ã‚‰ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ãŒå¤–ã‚ŒãŸå ´åˆã®å‡¦ç†ã‚’è¨˜è¿°ã—ã¾ã™ã€‚

ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‹ã‚‰ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ãŒå¤–ã‚ŒãŸå ´åˆã«ã‚‚`env.diagonal`ã®å€¤ã‚’`false`ã«ã—ã€å†æç”»ã‚’è¡Œã„ã¾ã™ã€‚

ã“ã‚Œã¯ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‹ã‚‰ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ãŒå¤–ã‚ŒãŸå ´åˆã«ã‚‚æ–œã‚ç§»å‹•ãŒæœ‰åŠ¹ãªã¾ã¾ã§ã‚ã‚‹ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã‚‹ã®ã‚’é˜²ããŸã‚ã§ã™ã€‚

```js
	c.on('keyup', function (e) {
		if (e.keyCode === 16) {
			if (env.diagonal) {
				env.diagonal = false;

				draw(con, env);
			}
		}
	});
	$(window).on('blur', function (e) {
		if (env.diagonal) {
			env.diagonal = false;

			draw(con, env);
		}
	});
```

æœ€å¾Œã«`draw`é–¢æ•°ã‚’å¤‰æ›´ã—ã¾ã™ã€‚

`env.diagonal`ã®å€¤ãŒ`true`ã§ã‚ã‚‹å ´åˆã®æç”»å‡¦ç†ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```js
function draw (con, env) {
ï¼ˆçœç•¥ï¼‰

	if (env.diagonal) {
		con.save();

		con.strokeStyle = 'white';
		con.translate(player.x * PX + (PX / 2), player.y * PY + (PY / 2));
		con.rotate(Math.PI / 4);
		con.beginPath();
		con.moveTo((PX / 2) + 4, -4);
		con.lineTo((PX / 2) + 4 + 8, -4);
		con.lineTo((PX / 2) + 4 + 8, -4 - 4);
		con.lineTo((PX / 2) + 4 + 8 + 8, 0);
		con.lineTo((PX / 2) + 4 + 8, 4 + 4);
		con.lineTo((PX / 2) + 4 + 8, 4);
		con.lineTo((PX / 2) + 4, 4);
		con.closePath();
		con.stroke();
		con.rotate(Math.PI / 4 * 2);
		con.beginPath();
		con.moveTo((PX / 2) + 4, -4);
		con.lineTo((PX / 2) + 4 + 8, -4);
		con.lineTo((PX / 2) + 4 + 8, -4 - 4);
		con.lineTo((PX / 2) + 4 + 8 + 8, 0);
		con.lineTo((PX / 2) + 4 + 8, 4 + 4);
		con.lineTo((PX / 2) + 4 + 8, 4);
		con.lineTo((PX / 2) + 4, 4);
		con.closePath();
		con.stroke();
		con.rotate(Math.PI / 4 * 2);
		con.beginPath();
		con.moveTo((PX / 2) + 4, -4);
		con.lineTo((PX / 2) + 4 + 8, -4);
		con.lineTo((PX / 2) + 4 + 8, -4 - 4);
		con.lineTo((PX / 2) + 4 + 8 + 8, 0);
		con.lineTo((PX / 2) + 4 + 8, 4 + 4);
		con.lineTo((PX / 2) + 4 + 8, 4);
		con.lineTo((PX / 2) + 4, 4);
		con.closePath();
		con.stroke();
		con.rotate(Math.PI / 4 * 2);
		con.beginPath();
		con.moveTo((PX / 2) + 4, -4);
		con.lineTo((PX / 2) + 4 + 8, -4);
		con.lineTo((PX / 2) + 4 + 8, -4 - 4);
		con.lineTo((PX / 2) + 4 + 8 + 8, 0);
		con.lineTo((PX / 2) + 4 + 8, 4 + 4);
		con.lineTo((PX / 2) + 4 + 8, 4);
		con.lineTo((PX / 2) + 4, 4);
		con.closePath();
		con.stroke();

		con.restore();
	}
}
```

ã“ã‚Œã§`Shift`ã‚­ãƒ¼ã‚’æŠ¼ã™ã¨ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å‘¨ã‚Šã«4ã¤ã®æ–œã‚çŸ¢å°ãŒè¡¨ç¤ºã•ã‚Œã€æ–œã‚ç§»å‹•ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

[](https://codepen.io/pizyumi/pen/NWKEMjQ)

<p class="codepen" data-height="600" data-theme-id="0" data-default-tab="result" data-user="pizyumi" data-slug-hash="NWKEMjQ" style="height: 600px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;" data-pen-title="roguelike-3-2">
  <span>See the Pen <a href="https://codepen.io/pizyumi/pen/NWKEMjQ/">
  roguelike-3-2</a> by pizyumi (<a href="https://codepen.io/pizyumi">@pizyumi</a>)
  on <a href="https://codepen.io">CodePen</a>.</span>
</p>
<script async src="https://static.codepen.io/assets/embed/ei.js"></script>

### ä»Šå›žã¯ã“ã“ã¾ã§

ä»Šå›žã¯ã“ã“ã¾ã§ã§ã™ã€‚

`game.js`ã¯ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

```js
ï»¿var TITLE = 'ã‚·ãƒ³ãƒ—ãƒ«ãƒ­ãƒ¼ã‚°ãƒ©ã‚¤ã‚¯';

var TEXT_START = 'ã¯ã˜ã‚ã‚‹';

var SCREEN_X = 1600;
var SCREEN_Y = 800;

var LX = 25;
var LY = 25;
var PX = 32;
var PY = 32;

var B_FLOOR = 0;
var B_WALL = 1;

var B_CAN_STAND = [];
B_CAN_STAND[B_FLOOR] = true;
B_CAN_STAND[B_WALL] = false;

var startf = false;

var field = null;
var player = null;

$(function(){
	var canvas = document.getElementById('game');
	var con = canvas.getContext('2d');

	var keyl = false;
	var keyu = false;
	var keyr = false;
	var keyd = false;

	var env = {
		diagonal: false
	};

	var c = $('body');
	c.on('keydown', function (e) {
		if (e.keyCode === 37) {
			keyl = true;
		}
		else if (e.keyCode === 38) {
			keyu = true;
		}
		else if (e.keyCode === 39) {
			keyr = true;
		}
		else if (e.keyCode === 40) {
			keyd = true;
		}
		else {
			keyl = false;
			keyu = false;
			keyr = false;
			keyd = false;
		}
	});
	c.on('keyup', function (e) {
		if (e.keyCode === 37) {
			keyl = false;
		}
		else if (e.keyCode === 38) {
			keyu = false;
		}
		else if (e.keyCode === 39) {
			keyr = false;
		}
		else if (e.keyCode === 40) {
			keyd = false;
		}
	});
	c.on('keydown', function (e) {
		if (!startf) {
			if (e.keyCode === 90) {
				startf = true;

				init();

				draw(con, env);
			}

			return;
		}

		if (e.keyCode === 16) {
			if (!env.diagonal) {
				env.diagonal = true;

				draw(con, env);
			}

			return;
		}

		if (e.keyCode >= 37 && e.keyCode <= 40) {
			var x = player.x;
			var y = player.y;
			if (e.shiftKey) {
				if (keyl && keyu) {
					if (x === 0 || y === 0) {
						return;
					}
					x--;
					y--;
				}
				else if (keyr && keyu) {
					if (x === LX - 1 || y === 0) {
						return;
					}
					x++;
					y--;
				}
				else if (keyl && keyd) {
					if (x === 0 || y === LY - 1) {
						return;
					}
					x--;
					y++;
				}
				else if (keyr && keyd) {
					if (x === LX - 1 || y === LY - 1) {
						return;
					}
					x++;
					y++;
				}
				else {
					return;
				}
			}
			else {
				if (e.keyCode === 37) {
					if (x === 0) {
						return;
					}
					x--;
				}
				else if (e.keyCode === 38) {
					if (y === 0) {
						return;
					}
					y--;
				}
				else if (e.keyCode === 39) {
					if (x === LX - 1) {
						return;
					}
					x++;
				}
				else if (e.keyCode === 40) {
					if (y === LY - 1) {
						return;
					}
					y++;
				}
			}

			if (x !== player.x || y !== player.y) {
				var block = field.blocks[x][y];
				if (B_CAN_STAND[block.base]) {
					player.x = x;
					player.y = y;
				}
				else {
					return;
				}
			}
			else {
				return;
			}
		}
		else {
			return;
		}

		draw(con, env);
	});
	c.on('keyup', function (e) {
		if (e.keyCode === 16) {
			if (env.diagonal) {
				env.diagonal = false;

				draw(con, env);
			}
		}
	});
	$(window).on('blur', function (e) {
		if (env.diagonal) {
			env.diagonal = false;

			draw(con, env);
		}
	});

	draw(con, env);
});

function init () {
	field = create_field();
	player = {
		x: 12,
		y: 17
	};
}

function create_field () {
	var blocks = [];
	for (var i = 0; i < LX; i++) {
		blocks[i] = [];
		for (var j = 0; j < LY; j++) {
			if ((i === 0 || j === 0) || (i === LX -1 || j === LY - 1)) {
				blocks[i][j] = {
					base: B_WALL
				};
			}
			else {
				blocks[i][j] = {
					base: B_FLOOR
				};
			}
		}
	}

	return {
		blocks: blocks
	};
}

function draw (con, env) {
	con.fillStyle = 'black';
	con.fillRect(0, 0, SCREEN_X, SCREEN_Y);

	if (!startf) {
		con.textBaseline = 'alphabetic';
		con.textAlign = 'center';
		con.fillStyle = 'white';

		con.font = "48px consolas";
		con.fillText(TITLE, SCREEN_X / 2, SCREEN_Y / 4);

		con.font = "32px consolas";
		con.fillText('> ' + TEXT_START, SCREEN_X / 2, SCREEN_Y / 4 * 3);

		return;
	}

	for (var i = 0; i < LX; i++) {
		for (var j = 0; j < LY; j++) {
			var block = field.blocks[i][j];
			if (block.base === B_FLOOR) {
				con.fillStyle = 'white';
				con.beginPath();
				con.arc((i + 0.5) * PX, (j + 0.5) * PY, 1, 0, Math.PI * 2);
				con.closePath();
				con.fill();
			}
			else if (block.base === B_WALL) {
				con.strokeStyle = 'white';
				con.strokeRect(i * PX, j * PY, PX, PY);
				con.beginPath();
				con.moveTo(i * PX, j * PY);
				con.lineTo((i + 1) * PX, (j + 1) * PY);
				con.moveTo((i + 1) * PX, j * PY);
				con.lineTo(i * PX, (j + 1) * PY);
				con.closePath();
				con.stroke();
			}
		}
	}

	con.textBaseline = 'middle';
	con.textAlign = 'center';
	con.fillStyle = 'red';
	con.font = '24px consolas';
	con.fillText('ðŸš¶\uFE0E', player.x * PX + (PX / 2), player.y * PY + (PY / 2));

	if (env.diagonal) {
		con.save();

		con.strokeStyle = 'white';
		con.translate(player.x * PX + (PX / 2), player.y * PY + (PY / 2));
		con.rotate(Math.PI / 4);
		con.beginPath();
		con.moveTo((PX / 2) + 4, -4);
		con.lineTo((PX / 2) + 4 + 8, -4);
		con.lineTo((PX / 2) + 4 + 8, -4 - 4);
		con.lineTo((PX / 2) + 4 + 8 + 8, 0);
		con.lineTo((PX / 2) + 4 + 8, 4 + 4);
		con.lineTo((PX / 2) + 4 + 8, 4);
		con.lineTo((PX / 2) + 4, 4);
		con.closePath();
		con.stroke();
		con.rotate(Math.PI / 4 * 2);
		con.beginPath();
		con.moveTo((PX / 2) + 4, -4);
		con.lineTo((PX / 2) + 4 + 8, -4);
		con.lineTo((PX / 2) + 4 + 8, -4 - 4);
		con.lineTo((PX / 2) + 4 + 8 + 8, 0);
		con.lineTo((PX / 2) + 4 + 8, 4 + 4);
		con.lineTo((PX / 2) + 4 + 8, 4);
		con.lineTo((PX / 2) + 4, 4);
		con.closePath();
		con.stroke();
		con.rotate(Math.PI / 4 * 2);
		con.beginPath();
		con.moveTo((PX / 2) + 4, -4);
		con.lineTo((PX / 2) + 4 + 8, -4);
		con.lineTo((PX / 2) + 4 + 8, -4 - 4);
		con.lineTo((PX / 2) + 4 + 8 + 8, 0);
		con.lineTo((PX / 2) + 4 + 8, 4 + 4);
		con.lineTo((PX / 2) + 4 + 8, 4);
		con.lineTo((PX / 2) + 4, 4);
		con.closePath();
		con.stroke();
		con.rotate(Math.PI / 4 * 2);
		con.beginPath();
		con.moveTo((PX / 2) + 4, -4);
		con.lineTo((PX / 2) + 4 + 8, -4);
		con.lineTo((PX / 2) + 4 + 8, -4 - 4);
		con.lineTo((PX / 2) + 4 + 8 + 8, 0);
		con.lineTo((PX / 2) + 4 + 8, 4 + 4);
		con.lineTo((PX / 2) + 4 + 8, 4);
		con.lineTo((PX / 2) + 4, 4);
		con.closePath();
		con.stroke();

		con.restore();
	}
}
```

æ¬¡å›žã¯ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ã®ç”Ÿæˆã‚’å°‘ã—ã ã‘è€ƒãˆã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚
