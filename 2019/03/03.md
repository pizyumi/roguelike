## „É≠„Éº„Ç∞„É©„Ç§„ÇØ„Ç≤„Éº„É†„Çí‰Ωú„Å£„Å¶„Åø„Çã„Åù„ÅÆ3 „Éó„É¨„Ç§„É§„Éº„ÅÆÁßªÂãï

ÂÖÉÈ¢®‰øóÂ¨¢„ÅÆ„ÇÜ„Çä„Å™„Åß„Åô„ÄÇ

È¢®‰øóÂ¨¢„Çí„ÇÑ„Å£„Åü„ÇâÁ≤æÁ•û„Åå„Éú„É≠„Éú„É≠„Å´„Å™„Å£„Å¶„Åó„Åæ„Å£„Åü„ÅÆ„Åß„ÄÅ„Å°„Çá„Å£„Å®Á∞°Âçò„Å™„Ç≤„Éº„É†„Åß„ÇÇ‰Ωú„Å£„Å¶„É™„Éï„É¨„ÉÉ„Ç∑„É•„Åô„Çã„Åì„Å®„Å´„Åó„Åæ„Åô„ÄÇ

### ÈÅéÂéªË®ò‰∫ã‰∏ÄË¶ß

* [„Åù„ÅÆ1 „Çø„Ç§„Éà„É´ÁîªÈù¢](https://qiita.com/pizyumi/items/3526fddd4f18a462e1ae)
* [„Åù„ÅÆ2 „ÉÄ„É≥„Ç∏„Éß„É≥„Éª„Éó„É¨„Ç§„É§„Éº„ÅÆÁîüÊàê„Å®ÊèèÁîª]()

ÁèæÂú®„ÅÆ„Ç≥„Éº„Éâ„Å´„Å§„ÅÑ„Å¶„ÅØÂâçÂõû„ÅÆË®ò‰∫ã„ÇíÂèÇÁÖß„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ

### „Éó„É¨„Ç§„É§„Éº„ÅÆÁßªÂãï

„Åì„ÅÆ„Ç≤„Éº„É†„ÅØÂü∫Êú¨ÁöÑ„Å´„Ç≠„Éº„Éú„Éº„Éâ„Çí‰Ωø„Å£„Å¶Êìç‰Ωú„Åô„Çã„Åì„Å®„Å´„Åó„Åæ„Åô„ÄÇ

„Éó„É¨„Ç§„É§„Éº„ÅÆÁßªÂãï„ÅØÁü¢Âç∞„Ç≠„Éº„Çí‰Ωø„Å£„Å¶Ë°å„ÅÜ„Åì„Å®„Å´„Åó„Åæ„Åô„ÄÇ

„Åæ„Åö„ÄÅ„Éó„É¨„Ç§„É§„Éº„ÅØÂÖ®„Å¶„ÅÆ„Éû„Çπ„Å´ÁßªÂãï„Åß„Åç„ÇãË®≥„Åß„ÅØ„Å™„ÅÑ„ÅÆ„Åß„Åó„Åü„ÄÇ

Â∫ä„ÅÆ„Éû„Çπ„Å´„ÅØÁßªÂãï„Åß„Åç„Åæ„Åô„Åå„ÄÅÂ£Å„ÅÆ„Éû„Çπ„Å´„ÅØÁßªÂãï„Åß„Åç„Åæ„Åõ„Çì„ÄÇ

„Å§„Åæ„Çä„ÄÅ„Éû„Çπ„ÅÆÁ®ÆÈ°û„Å´„Çà„Å£„Å¶ÁßªÂãï„Åß„Åç„Çã„Åã„Å©„ÅÜ„Åã„ÅåÊ±∫„Åæ„Çä„Åæ„Åô„ÄÇ

„Åì„Çå„Çí`B_CAN_STAND`„Å®„ÅÑ„ÅÜÈÖçÂàó„Åß‰∏ã„ÅÆ„Çà„ÅÜ„Å´ÂÆöÁæ©„Åô„Çã„Åì„Å®„Å´„Åó„Åæ„Åô„ÄÇ`true`„ÅØÁßªÂãï„Åß„Åç„Çã„Éû„Çπ„Åß„ÅÇ„Çã„Åì„Å®„ÇíË°®„Åó„ÄÅ`false`„ÅØÁßªÂãï„Åß„Åç„Å™„ÅÑ„Éû„Çπ„Åß„ÅÇ„Çã„Åì„Å®„ÇíË°®„Åó„Åæ„Åô„ÄÇ

```js
var B_CAN_STAND = [];
B_CAN_STAND[B_FLOOR] = true;
B_CAN_STAND[B_WALL] = false;
```

„Åù„Åó„Å¶„ÄÅ„Ç≠„ÉºÂÖ•Âäõ„ÅÆÂá¶ÁêÜ„Çí‰∏ã„ÅÆ„Çà„ÅÜ„Å´Â§âÊõ¥„Åó„Åæ„Åô„ÄÇ

„Å™„Åä„ÄÅÁü¢Âç∞„Ç≠„Éº„ÅÆ`keyCode`„ÅÆÂÄ§„ÅØ„Åù„Çå„Åû„Çå‰∏ã„ÅÆ„Çà„ÅÜ„Å´„Å™„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ

* `‚Üê`„Éª„Éª„Éª`37`
* `‚Üë`„Éª„Éª„Éª`38`
* `‚Üí`„Éª„Éª„Éª`39`
* `‚Üì`„Éª„Éª„Éª`40`

```js
	c.on('keydown', function (e) {
		if (!startf) {
			if (e.keyCode === 90) {
				startf = true;

				init();

				draw(con);
			}

			return;
		}

		if (e.keyCode >= 37 && e.keyCode <= 40) {
			var x = player.x;
			var y = player.y;
			if (e.keyCode === 37) {
				if (x === 0) {
					return;
				}
				x--;
			}
			else if (e.keyCode === 38) {
				if (y === 0) {
					return;
				}
				y--;
			}
			else if (e.keyCode === 39) {
				if (x === LX - 1) {
					return;
				}
				x++;
			}
			else if (e.keyCode === 40) {
				if (y === LY - 1) {
					return;
				}
				y++;
			}

			if (x !== player.x || y !== player.y) {
				var b = field[x][y];
				if (B_CAN_STAND[b.base]) {
					player.x = x;
					player.y = y;

					draw(con);
				}
			}
		}
	});
```

Áü¢Âç∞„Ç≠„Éº„ÅåÊäº„Åï„Çå„ÅüÊôÇ„ÅÆÂá¶ÁêÜ„ÅåËøΩÂä†„Åï„Çå„Åæ„Åó„Åü„ÄÇ

Áü¢Âç∞„Ç≠„Éº„ÅÆÁ®ÆÈ°û„Å´„Çà„Å£„Å¶„Éó„É¨„Ç§„É§„Éº„ÅÆÊñ∞„Åó„ÅÑ‰ΩçÁΩÆ„ÅåÊ±∫„Åæ„Çä„ÄÅ„Åù„ÅÆ‰ΩçÁΩÆ„ÅÆ„Éû„Çπ„ÅÆÁ®ÆÈ°û„ÅåÁßªÂãï„Åß„Åç„Çã„ÇÇ„ÅÆ„Åß„ÅÇ„ÇãÂ†¥Âêà„Å´„ÅØÁßªÂãï„ÅóÔºà„Éó„É¨„Ç§„É§„Éº„ÅÆ‰ΩçÁΩÆ„ÇíÊõ¥Êñ∞„ÅóÔºâ„ÄÅÂÜçÊèèÁîª„ÇíË°å„ÅÑ„Åæ„Åô„ÄÇ

[](https://codepen.io/pizyumi/pen/ExYOVwj)

<p class="codepen" data-height="600" data-theme-id="0" data-default-tab="result" data-user="pizyumi" data-slug-hash="ExYOVwj" style="height: 600px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;" data-pen-title="roguelike-3-1">
  <span>See the Pen <a href="https://codepen.io/pizyumi/pen/ExYOVwj/">
  roguelike-3-1</a> by pizyumi (<a href="https://codepen.io/pizyumi">@pizyumi</a>)
  on <a href="https://codepen.io">CodePen</a>.</span>
</p>
<script async src="https://static.codepen.io/assets/embed/ei.js"></script>

### Êñú„ÇÅÁßªÂãï

„É≠„Éº„Ç∞„É©„Ç§„ÇØ„Ç≤„Éº„É†„ÅØ„ÇÑ„Å£„Å±„ÇäÊñú„ÇÅÁßªÂãï„ÇÇ„Åß„Åç„Å™„ÅÑ„Å®„Åß„Åô„Çà„Å≠„ÄÇ

Êñú„ÇÅÁßªÂãï„ÇíÂÆüË£Ö„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ

Êñú„ÇÅÁßªÂãï„ÅØ`Shift`„Ç≠„Éº„ÇíÊäº„Åó„Å™„Åå„ÇâÁü¢Âç∞„Ç≠„Éº„ÇíÊäº„Åô„Åì„Å®„ÅßË°å„ÅÜ„Åì„Å®„Å´„Åó„Åæ„Åô„ÄÇ

ÂÆüË£Ö„Å´„Åä„ÅÑ„Å¶„ÅØÂ∞ë„Å™„Åè„Å®„ÇÇ‰ª•‰∏ã„ÅÆ2ÁÇπ„ÇíÊ∫Ä„Åü„ÅôÂøÖË¶Å„Åå„ÅÇ„Çã„Åã„Å®ÊÄù„ÅÑ„Åæ„Åô„ÄÇ

* `Shift`„Ç≠„Éº„ÇíÊäº„Åó„Å¶„ÅÑ„ÇãÊôÇ„ÅÆ„Åø„Åó„ÅãÊñú„ÇÅÁßªÂãï„Åß„Åç„Å™„ÅÑÔºà`Shift`„Ç≠„Éº„ÇíÊäº„Åó„Å¶„ÅÑ„Å™„ÅÑ„ÅÆ„Å´Êñú„ÇÅÁßªÂãï„Åß„Åç„Å¶„ÅØ„Å™„Çâ„Å™„ÅÑÔºâ„ÄÇ
* `Shift`„Ç≠„Éº„ÇíÊäº„Åó„Å¶„ÅÑ„ÇãÊôÇ„Å´„ÅØÊñú„ÇÅÁßªÂãï„Åó„ÅãÂá∫Êù•„Å™„ÅÑÔºà`Shift`„Ç≠„Éº„ÇíÊäº„Åó„Å¶„ÅÑ„ÇãÊôÇ„Å´„ÅØ‰∏ä‰∏ãÂ∑¶Âè≥„ÅÆÁßªÂãï„ÅØ„Åß„Åç„Å¶„ÅØ„Å™„Çâ„Å™„ÅÑÔºâ„ÄÇ

„Åì„ÅÆ„Çà„ÅÜ„Å´„Åô„Çã„Åì„Å®„Å´„Çà„Çä„ÄÅË™§Êìç‰Ωú„ÅåËµ∑„Åç„Å´„Åè„Åè„Å™„Çä„Åæ„Åô„ÄÇ

„Åì„ÅÆ„Çà„ÅÜ„Å™Êñú„ÇÅÁßªÂãï„ÅÆÂÆüË£ÖÊñπÊ≥ï„ÅØÂπæ„Å§„Åã„ÅÇ„Çã„Å®ÊÄù„ÅÑ„Åæ„Åô„Åå„ÄÅÁßÅ„ÅØ‰∏ã„ÅÆ„Çà„ÅÜ„Å™ÂÆüË£ÖÊñπÊ≥ï„ÅåÂ•Ω„Åç„Åß„Åô„ÄÇ

`keyl`„ÄÅ`keyu`„ÄÅ`keyr`„ÄÅ`keyd`„Å®„ÅÑ„ÅÜÂ§âÊï∞„ÇíÁî®ÊÑè„Åó„ÄÅÁü¢Âç∞„Ç≠„Éº„ÅåÊäº„Åï„Çå„Å¶„ÅÑ„Çã„Åã„Å©„ÅÜ„Åã„ÇíÂ∏∏„Å´Áõ£Ë¶ñ„Åô„Çã„Çà„ÅÜ„Å´„Åó„Åæ„Åô„ÄÇ

„Åù„Åó„Å¶„ÄÅ`Shift`„Ç≠„Éº„ÅåÊäº„Åï„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà„Å´„ÅØ„Åì„Çå„Çâ„ÅÆÂ§âÊï∞„ÅÆÂÄ§„Çí„ÇÇ„Å®„Å´ÁßªÂãï„ÇíË°å„ÅÜ„Åπ„Åç„Åã„ÇíÂà§Êñ≠„Åó„Åæ„Åô„ÄÇ

```js
	var keyl = false;
	var keyu = false;
	var keyr = false;
	var keyd = false;

	var c = $('body');
	c.on('keydown', function (e) {
		if (e.keyCode === 37) {
			keyl = true;
		}
		else if (e.keyCode === 38) {
			keyu = true;
		}
		else if (e.keyCode === 39) {
			keyr = true;
		}
		else if (e.keyCode === 40) {
			keyd = true;
		}
		else {
			keyl = false;
			keyu = false;
			keyr = false;
			keyd = false;
		}
	});
	c.on('keyup', function (e) {
		if (e.keyCode === 37) {
			keyl = false;
		}
		else if (e.keyCode === 38) {
			keyu = false;
		}
		else if (e.keyCode === 39) {
			keyr = false;
		}
		else if (e.keyCode === 40) {
			keyd = false;
		}
	});
	c.on('keydown', function (e) {
		if (!startf) {
ÔºàÁúÅÁï•Ôºâ
		}

		if (e.keyCode >= 37 && e.keyCode <= 40) {
			var x = player.x;
			var y = player.y;
			if (e.shiftKey) {
				if (keyl && keyu) {
					if (x === 0 || y === 0) {
						return;
					}
					x--;
					y--;
				}
				else if (keyr && keyu) {
					if (x === LX - 1 || y === 0) {
						return;
					}
					x++;
					y--;
				}
				else if (keyl && keyd) {
					if (x === 0 || y === LY - 1) {
						return;
					}
					x--;
					y++;
				}
				else if (keyr && keyd) {
					if (x === LX - 1 || y === LY - 1) {
						return;
					}
					x++;
					y++;
				}
				else {
					return;
				}
			}
			else {
				if (e.keyCode === 37) {
					if (x === 0) {
						return;
					}
					x--;
				}
				else if (e.keyCode === 38) {
					if (y === 0) {
						return;
					}
					y--;
				}
				else if (e.keyCode === 39) {
					if (x === LX - 1) {
						return;
					}
					x++;
				}
				else if (e.keyCode === 40) {
					if (y === LY - 1) {
						return;
					}
					y++;
				}
			}

			if (x !== player.x || y !== player.y) {
				var b = field[x][y];
				if (B_CAN_STAND[b.base]) {
					player.x = x;
					player.y = y;

					draw(con);
				}
			}
		}
	});
```

### Êñú„ÇÅÁü¢Âç∞„ÅÆË°®Á§∫

`Shift`„Ç≠„Éº„ÇíÊäº„Åó„ÅüÊôÇ„Å´Êñú„ÇÅÁßªÂãï„ÅåÂèØËÉΩ„Å™„Åì„Å®„Çí„É¶„Éº„Ç∂„Éº„Å´ÂàÜ„Åã„Çä„ÇÑ„Åô„ÅèË¶ã„Åõ„Çã„Åü„ÇÅ„Å´„ÄÅ`Shift`„Ç≠„Éº„ÇíÊäº„Åó„ÅüÊôÇ„Å´„Éó„É¨„Ç§„É§„Éº„ÅÆÂë®„Çä„Å´Êñú„ÇÅÁü¢Âç∞„ÅåË°®Á§∫„Åï„Çå„Çã„Çà„ÅÜ„Å´„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ

„Åì„ÅÆÊñú„ÇÅÁü¢Âç∞„ÅØ„ÄÅ„Åü„Å®„Åà„Å∞„ÄÅ„Åµ„ÅóÂπªÔºà‰∏çÊÄùË≠∞„ÅÆÂπªÊÉ≥ÈÉ∑Ôºâ„Åß„ÇÇÊé°Áî®„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„Å≠„ÄÇ

![](01.jpg)

„Åì„Çå„ÇíË°å„ÅÜ„Å´„ÅØ„ÄÅ`Shift`„Ç≠„Éº„ÅåÊäº„Åï„Çå„Å¶„ÅÑ„Çã„ÅãÔºà„Å®„ÅÑ„ÅÜ„ÅãÊñú„ÇÅÁßªÂãïÂèØËÉΩ„Å™Áä∂ÊÖã„ÅãÔºâ„Çí‰øùÊåÅ„Åó„Å¶„Åä„ÅèÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ

„Åì„ÅÆÁä∂ÊÖã„ÅØ`env.diagonal`„Åß‰øùÊåÅ„Åô„Çã„Åì„Å®„Å´„Åó„Åæ„Åô„ÄÇ`env.diagonal`„ÅÆÂÄ§„Åå`true`„Åß„ÅÇ„ÇãÂ†¥Âêà„Å´„ÅØÊñú„ÇÅÁßªÂãïÂèØËÉΩ„Åß„ÄÅ`false`„Åß„ÅÇ„ÇãÂ†¥Âêà„Å´„ÅØÊñú„ÇÅÁßªÂãï‰∏çÂèØËÉΩ„Åß„Åô„ÄÇ

```js
	var env = {
		diagonal: false
	};
```

„Åù„Åó„Å¶„ÄÅ„Åì„ÅÆÁä∂ÊÖãÔºà`env.diagonal`„ÅÆÂÄ§Ôºâ„Å´„Çà„Å£„Å¶„Ç≤„Éº„É†„ÅÆÊèèÁîªÂÜÖÂÆπÔºà„Éó„É¨„Ç§„É§„Éº„ÅÆÂë®„Çä„Å´Êñú„ÇÅÁü¢Âç∞„ÇíË°®Á§∫„Åô„Çã„Åã„Å©„ÅÜ„ÅãÔºâ„ÅåÂ§â„Çè„Çä„Åæ„Åô„ÅÆ„Åß„ÄÅ„Åì„ÅÆÁä∂ÊÖã„ÅØ`draw`Èñ¢Êï∞„Å´Ê∏°„Åï„Å™„Åë„Çå„Å∞„Å™„Çâ„Å™„ÅÑ„Å®„ÅÑ„ÅÜ„Åì„Å®„Å´„Å™„Çä„Åæ„Åô„ÄÇ

„Åù„Åì„Åß„ÄÅÂÖ®„Å¶„ÅÆ`draw`Èñ¢Êï∞„ÅÆÂëº„Å≥Âá∫„Åó„Å´„Åä„ÅÑ„Å¶„ÅØ`env`„ÇíÁ¨¨2ÂºïÊï∞„Å®„Åó„Å¶ÊåáÂÆö„Åô„Çã„Åì„Å®„Å´„Åó„Åæ„Åô„ÄÇ

„Åù„ÅÜ„Åó„Åü„Çâ„ÄÅ2„Å§ÁõÆ„ÅÆ`keydown`„Ç§„Éô„É≥„Éà„Éè„É≥„Éâ„É©„Çí‰∏ã„ÅÆ„Çà„ÅÜ„Å´Â§âÊõ¥„Åó„Åæ„Åô„ÄÇ

„Å§„Åæ„Çä„ÄÅ`Shift`„Ç≠„Éº„ÅåÊäº„Åï„Çå„ÅüÂ†¥Âêà„ÅÆÂá¶ÁêÜ„ÇíËøΩÂä†„Åó„Åæ„Åô„ÄÇ

`Shift`„Ç≠„Éº„ÅåÊäº„Åï„Çå„ÅüÂ†¥Âêà„Å´„ÅØ`env.diagonal`„ÅÆÂÄ§„Çí`true`„Å´„Åó„ÄÅÂÜçÊèèÁîª„ÇíË°å„ÅÑ„Åæ„Åô„ÄÇ

```js
	c.on('keydown', function (e) {
		if (!startf) {
ÔºàÁúÅÁï•Ôºâ
		}

		if (e.keyCode === 16) {
			if (!env.diagonal) {
				env.diagonal = true;

				draw(con, env);
			}

			return;
		}

		if (e.keyCode >= 37 && e.keyCode <= 40) {
ÔºàÁúÅÁï•Ôºâ
		}
	});
```

Êõ¥„Å´„ÄÅÊñ∞„Åü„Å´`keyup`„Ç§„Éô„É≥„Éà„Éè„É≥„Éâ„É©„Å®`focusout`„Ç§„Éô„É≥„Éà„Éè„É≥„Éâ„É©„ÇíËøΩÂä†„Åó„Åæ„Åô„ÄÇ

`keyup`„Ç§„Éô„É≥„Éà„Éè„É≥„Éâ„É©„Å´„ÅØ`Shift`„Ç≠„Éº„ÅåÈõ¢„Åï„Çå„ÅüÂ†¥Âêà„ÅÆÂá¶ÁêÜ„ÇíË®òËø∞„Åó„Åæ„Åô„ÄÇ

`Shift`„Ç≠„Éº„ÅåÈõ¢„Åï„Çå„ÅüÂ†¥Âêà„Å´„ÅØ`env.diagonal`„ÅÆÂÄ§„Çí`false`„Å´„Åó„ÄÅÂÜçÊèèÁîª„ÇíË°å„ÅÑ„Åæ„Åô„ÄÇ

`focusout`„Ç§„Éô„É≥„Éà„Éè„É≥„Éâ„É©„Å´„ÅØ`env.diagonal`„ÅÆÂÄ§„Çí`false`„Å´„Åó„ÄÅÂÜçÊèèÁîª„ÇíË°å„ÅÜ„Ç≥„Éº„Éâ„ÇíË®òËø∞„Åó„Åæ„Åô„ÄÇ

„Åì„Çå„ÅØ„Éï„Ç©„Éº„Ç´„Çπ„ÅåÂ§ñ„Çå„ÅüÂ†¥Âêà„Å´„ÇÇÊñú„ÇÅÁßªÂãï„ÅåÊúâÂäπ„Å™„Åæ„Åæ„Å®„Å™„Å£„Å¶„Åó„Åæ„ÅÜ„ÅÆ„ÇíÈò≤„Åê„Åü„ÇÅ„Åß„Åô„ÄÇ

```js
	c.on('keyup', function (e) {
		if (e.keyCode === 16) {
			if (env.diagonal) {
				env.diagonal = false;

				draw(con, env);
			}
		}
	});
	c.on('focusout', function (e) {
		if (env.diagonal) {
			env.diagonal = false;

			draw(con, env);
		}
	});
```

ÊúÄÂæå„Å´`draw`Èñ¢Êï∞„ÇíÂ§âÊõ¥„Åó„Åæ„Åô„ÄÇ

`env.diagonal`„ÅÆÂÄ§„Åå`true`„Åß„ÅÇ„ÇãÂ†¥Âêà„ÅÆÊèèÁîªÂá¶ÁêÜ„ÇíËøΩÂä†„Åó„Åæ„Åô„ÄÇ

```js
function draw (con, env) {
ÔºàÁúÅÁï•Ôºâ

	if (env.diagonal) {
		con.save();

		con.strokeStyle = 'white';
		con.translate(player.x * PX + (PX / 2), player.y * PY + (PY / 2));
		con.rotate(Math.PI / 4);
		con.beginPath();
		con.moveTo((PX / 2) + 4, -4);
		con.lineTo((PX / 2) + 4 + 8, -4);
		con.lineTo((PX / 2) + 4 + 8, -4 - 4);
		con.lineTo((PX / 2) + 4 + 8 + 8, 0);
		con.lineTo((PX / 2) + 4 + 8, 4 + 4);
		con.lineTo((PX / 2) + 4 + 8, 4);
		con.lineTo((PX / 2) + 4, 4);
		con.closePath();
		con.stroke();
		con.rotate(Math.PI / 4 * 2);
		con.beginPath();
		con.moveTo((PX / 2) + 4, -4);
		con.lineTo((PX / 2) + 4 + 8, -4);
		con.lineTo((PX / 2) + 4 + 8, -4 - 4);
		con.lineTo((PX / 2) + 4 + 8 + 8, 0);
		con.lineTo((PX / 2) + 4 + 8, 4 + 4);
		con.lineTo((PX / 2) + 4 + 8, 4);
		con.lineTo((PX / 2) + 4, 4);
		con.closePath();
		con.stroke();
		con.rotate(Math.PI / 4 * 2);
		con.beginPath();
		con.moveTo((PX / 2) + 4, -4);
		con.lineTo((PX / 2) + 4 + 8, -4);
		con.lineTo((PX / 2) + 4 + 8, -4 - 4);
		con.lineTo((PX / 2) + 4 + 8 + 8, 0);
		con.lineTo((PX / 2) + 4 + 8, 4 + 4);
		con.lineTo((PX / 2) + 4 + 8, 4);
		con.lineTo((PX / 2) + 4, 4);
		con.closePath();
		con.stroke();
		con.rotate(Math.PI / 4 * 2);
		con.beginPath();
		con.moveTo((PX / 2) + 4, -4);
		con.lineTo((PX / 2) + 4 + 8, -4);
		con.lineTo((PX / 2) + 4 + 8, -4 - 4);
		con.lineTo((PX / 2) + 4 + 8 + 8, 0);
		con.lineTo((PX / 2) + 4 + 8, 4 + 4);
		con.lineTo((PX / 2) + 4 + 8, 4);
		con.lineTo((PX / 2) + 4, 4);
		con.closePath();
		con.stroke();

		con.restore();
	}
}
```

„Åì„Çå„Åß`Shift`„Ç≠„Éº„ÇíÊäº„Åô„Å®„Éó„É¨„Ç§„É§„Éº„ÅÆÂë®„Çä„Å´4„Å§„ÅÆÊñú„ÇÅÁü¢Âç∞„ÅåË°®Á§∫„Åï„Çå„ÄÅÊñú„ÇÅÁßªÂãï„Åß„Åç„Çã„Çà„ÅÜ„Å´„Å™„Çä„Åæ„Åó„Åü„ÄÇ

[](https://codepen.io/pizyumi/pen/NWKEMjQ)

<p class="codepen" data-height="600" data-theme-id="0" data-default-tab="result" data-user="pizyumi" data-slug-hash="NWKEMjQ" style="height: 600px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;" data-pen-title="roguelike-3-2">
  <span>See the Pen <a href="https://codepen.io/pizyumi/pen/NWKEMjQ/">
  roguelike-3-2</a> by pizyumi (<a href="https://codepen.io/pizyumi">@pizyumi</a>)
  on <a href="https://codepen.io">CodePen</a>.</span>
</p>
<script async src="https://static.codepen.io/assets/embed/ei.js"></script>

### ‰ªäÂõû„ÅØ„Åì„Åì„Åæ„Åß

‰ªäÂõû„ÅØ„Åì„Åì„Åæ„Åß„Åß„Åô„ÄÇ

`game.js`„ÅØ‰∏ã„ÅÆ„Çà„ÅÜ„Å´„Å™„Çä„Åæ„Åó„Åü„ÄÇ

```js
Ôªøvar TITLE = '„Ç∑„É≥„Éó„É´„É≠„Éº„Ç∞„É©„Ç§„ÇØ';

var SCREEN_X = 1600;
var SCREEN_Y = 800;

var LX = 25;
var LY = 25;
var PX = 32;
var PY = 32;

var B_FLOOR = 0;
var B_WALL = 1;

var B_CAN_STAND = [];
B_CAN_STAND[B_FLOOR] = true;
B_CAN_STAND[B_WALL] = false;

var startf = false;

var field = null;
var player = null;

$(function(){
	var canvas = document.getElementById('game');
	var con = canvas.getContext('2d');

	var keyl = false;
	var keyu = false;
	var keyr = false;
	var keyd = false;

	var env = {
		diagonal: false
	};

	var c = $('body');
	c.on('keydown', function (e) {
		if (e.keyCode === 37) {
			keyl = true;
		}
		else if (e.keyCode === 38) {
			keyu = true;
		}
		else if (e.keyCode === 39) {
			keyr = true;
		}
		else if (e.keyCode === 40) {
			keyd = true;
		}
		else {
			keyl = false;
			keyu = false;
			keyr = false;
			keyd = false;
		}
	});
	c.on('keyup', function (e) {
		if (e.keyCode === 37) {
			keyl = false;
		}
		else if (e.keyCode === 38) {
			keyu = false;
		}
		else if (e.keyCode === 39) {
			keyr = false;
		}
		else if (e.keyCode === 40) {
			keyd = false;
		}
	});
	c.on('keydown', function (e) {
		if (!startf) {
			if (e.keyCode === 90) {
				startf = true;

				init();

				draw(con, env);
			}

			return;
		}

		if (e.keyCode === 16) {
			if (!env.diagonal) {
				env.diagonal = true;

				draw(con, env);
			}

			return;
		}

		if (e.keyCode >= 37 && e.keyCode <= 40) {
			var x = player.x;
			var y = player.y;
			if (e.shiftKey) {
				if (keyl && keyu) {
					if (x === 0 || y === 0) {
						return;
					}
					x--;
					y--;
				}
				else if (keyr && keyu) {
					if (x === LX - 1 || y === 0) {
						return;
					}
					x++;
					y--;
				}
				else if (keyl && keyd) {
					if (x === 0 || y === LY - 1) {
						return;
					}
					x--;
					y++;
				}
				else if (keyr && keyd) {
					if (x === LX - 1 || y === LY - 1) {
						return;
					}
					x++;
					y++;
				}
				else {
					return;
				}
			}
			else {
				if (e.keyCode === 37) {
					if (x === 0) {
						return;
					}
					x--;
				}
				else if (e.keyCode === 38) {
					if (y === 0) {
						return;
					}
					y--;
				}
				else if (e.keyCode === 39) {
					if (x === LX - 1) {
						return;
					}
					x++;
				}
				else if (e.keyCode === 40) {
					if (y === LY - 1) {
						return;
					}
					y++;
				}
			}

			if (x !== player.x || y !== player.y) {
				var b = field[x][y];
				if (B_CAN_STAND[b.base]) {
					player.x = x;
					player.y = y;

					draw(con, env);
				}
			}
		}
	});
	c.on('keyup', function (e) {
		if (e.keyCode === 16) {
			if (env.diagonal) {
				env.diagonal = false;

				draw(con, env);
			}
		}
	});
	c.on('focusout', function (e) {
		if (env.diagonal) {
			env.diagonal = false;

			draw(con, env);
		}
	});

	draw(con, env);
});

function init () {
	field = create_field();
	player = {
		x: 12,
		y: 17
	};
}

function create_field () {
	var f = [];
	for (var i = 0; i < LX; i++) {
		f[i] = [];
		for (var j = 0; j < LY; j++) {
			if ((i === 0 || j === 0) || (i === LX -1 || j === LY - 1)) {
				f[i][j] = {
					base: B_WALL
				};
			}
			else {
				f[i][j] = {
					base: B_FLOOR
				};
			}
		}
	}

	return f;
}

function draw (con, env) {
	con.fillStyle = 'black';
	con.fillRect(0, 0, SCREEN_X, SCREEN_Y);

	if (!startf) {
		con.textBaseline = 'alphabetic';
		con.textAlign = 'center';
		con.fillStyle = 'white';

		con.font = "48px consolas";
		con.fillText(TITLE, SCREEN_X / 2, SCREEN_Y / 4);

		con.font = "32px consolas";
		con.fillText('> „ÅØ„Åò„ÇÅ„Çã', SCREEN_X / 2, SCREEN_Y / 4 * 3);

		return;
	}

	for (var i = 0; i < LX; i++) {
		for (var j = 0; j < LY; j++) {
			if (field[i][j].base === B_FLOOR) {
				con.fillStyle = 'white';
				con.beginPath();
				con.arc((i + 0.5) * PX, (j + 0.5) * PY, 1, 0, Math.PI * 2);
				con.closePath();
				con.fill();
			}
			else if (field[i][j].base === B_WALL) {
				con.strokeStyle = 'white';
				con.strokeRect(i * PX, j * PY, PX, PY);
				con.beginPath();
				con.moveTo(i * PX, j * PY);
				con.lineTo((i + 1) * PX, (j + 1) * PY);
				con.moveTo((i + 1) * PX, j * PY);
				con.lineTo(i * PX, (j + 1) * PY);
				con.closePath();
				con.stroke();
			}
		}
	}

	con.textBaseline = 'middle';
	con.textAlign = 'center';
	con.fillStyle = 'red';
	con.fillText('üö∂\uFE0E', player.x * PX + (PX / 2), player.y * PY + (PY / 2));

	if (env.diagonal) {
		con.save();

		con.strokeStyle = 'white';
		con.translate(player.x * PX + (PX / 2), player.y * PY + (PY / 2));
		con.rotate(Math.PI / 4);
		con.beginPath();
		con.moveTo((PX / 2) + 4, -4);
		con.lineTo((PX / 2) + 4 + 8, -4);
		con.lineTo((PX / 2) + 4 + 8, -4 - 4);
		con.lineTo((PX / 2) + 4 + 8 + 8, 0);
		con.lineTo((PX / 2) + 4 + 8, 4 + 4);
		con.lineTo((PX / 2) + 4 + 8, 4);
		con.lineTo((PX / 2) + 4, 4);
		con.closePath();
		con.stroke();
		con.rotate(Math.PI / 4 * 2);
		con.beginPath();
		con.moveTo((PX / 2) + 4, -4);
		con.lineTo((PX / 2) + 4 + 8, -4);
		con.lineTo((PX / 2) + 4 + 8, -4 - 4);
		con.lineTo((PX / 2) + 4 + 8 + 8, 0);
		con.lineTo((PX / 2) + 4 + 8, 4 + 4);
		con.lineTo((PX / 2) + 4 + 8, 4);
		con.lineTo((PX / 2) + 4, 4);
		con.closePath();
		con.stroke();
		con.rotate(Math.PI / 4 * 2);
		con.beginPath();
		con.moveTo((PX / 2) + 4, -4);
		con.lineTo((PX / 2) + 4 + 8, -4);
		con.lineTo((PX / 2) + 4 + 8, -4 - 4);
		con.lineTo((PX / 2) + 4 + 8 + 8, 0);
		con.lineTo((PX / 2) + 4 + 8, 4 + 4);
		con.lineTo((PX / 2) + 4 + 8, 4);
		con.lineTo((PX / 2) + 4, 4);
		con.closePath();
		con.stroke();
		con.rotate(Math.PI / 4 * 2);
		con.beginPath();
		con.moveTo((PX / 2) + 4, -4);
		con.lineTo((PX / 2) + 4 + 8, -4);
		con.lineTo((PX / 2) + 4 + 8, -4 - 4);
		con.lineTo((PX / 2) + 4 + 8 + 8, 0);
		con.lineTo((PX / 2) + 4 + 8, 4 + 4);
		con.lineTo((PX / 2) + 4 + 8, 4);
		con.lineTo((PX / 2) + 4, 4);
		con.closePath();
		con.stroke();

		con.restore();
	}
}
```

Ê¨°Âõû„ÅØ„ÉÄ„É≥„Ç∏„Éß„É≥„ÅÆÁîüÊàê„ÇíÂ∞ë„Åó„Å†„ÅëËÄÉ„Åà„Å¶„Åø„Åü„ÅÑ„Å®ÊÄù„ÅÑ„Åæ„Åô„ÄÇ
